---
title: "Suicide Data Analysis Project"
author: "Stats Stars"
date: "04/29/19"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

Your project goes here! Before you submit, make sure your chunks are turned off with `echo = FALSE`. 

You can add sections as you see fit. Make sure you have a section called Introduction at the beginning and a section called Conclusion at the end. The rest is up to you!

### Introduction

### Load Data and Libraries

```{r load-data, message=FALSE}
library(tidyverse)
library(broom)
suicides <- read_csv("/cloud/project/data/master.csv")
```

### Suicides and Location

```{r country-plot, fig.height=10, fig.width=8}
topcountries <- suicides %>%
  group_by(country) %>%
  summarise(n = mean(`suicides/100k pop`)) %>%
  filter(n!=0) %>%
  arrange(desc(n))

ggplot(data = topcountries, mapping = aes(x = reorder(country,n), y = n)) +
  geom_bar(aes(y = n), stat = "Identity", fill="blue") +
  coord_flip() +
  labs(title = "Suicides per 100k people",
       subtitle = "by country",
       x = "Country",
       y = "Count")
```

```{r highest-rate-by-country}
topcountries
```


### Suicides and Economic Situation over all Time

```{r create-dataframe-grouping-data-countryyear}
#aggregated all the suicides/100k pop data per country-year
suicides_grouped <- aggregate(`suicides/100k pop` ~ `country-year`, data = suicides, FUN=sum)

#merged data set created with old one to have access to gdp data
suicide_economics <- merge(suicides, suicides_grouped, by.x = "country-year", by.y = "country-year") %>%
  select(`country-year`, `suicides/100k pop.y`, `gdp_per_capita ($)`)
```

```{r vis-suicide-gdp-per-capita}
ggplot(data = suicide_economics, mapping = aes(x = `gdp_per_capita ($)`, y = `suicides/100k pop.y`)) + 
  geom_point(size = 0.1, color = "blue") +
  geom_smooth(method = "lm", se = FALSE,
              col = "orange") +
  labs(title = "Suicides per 100k of the population vs. GDP per capita",
       x = "GDP per capita ($)",
       y = "Suicides per 100k of the population")
```

```{r linear-model-suicide-economics}
model_gdp_suicides <- lm(`suicides/100k pop.y` ~ `gdp_per_capita ($)`, data = suicide_economics)
tidy(model_gdp_suicides)
glance(model_gdp_suicides)$r.squared
```
Equation for the linear model is: (Suicides per 100k of the population-hat) = (1.533301e+02) + (1.830459e-05*GDP per capita($)) 
R-squared value is: 8.740802e-06

### Suicides and Economic Situation in 2015

```{r create-dataframe-grouping-data-countryyear-2015}
suicides_current <- suicides %>%
  filter(year == "2015")

#aggregated all the suicides/100k pop data per country-year
suicides_grouped_current <- aggregate(`suicides/100k pop` ~ `country-year`, data = suicides_current, FUN=sum)

#merged data set created with old one to have access to gdp data
suicide_economics_current <- merge(suicides, suicides_grouped_current, by.x = "country-year", by.y = "country-year") %>%
  select(`country-year`, `suicides/100k pop.y`, `gdp_per_capita ($)`)
```

```{r vis-suicide-gdp-per-capita-2015}
ggplot(data = suicide_economics_current, mapping = aes(x = `gdp_per_capita ($)`, y = `suicides/100k pop.y`)) + 
  geom_point(size = 0.1, color = "blue") +
  geom_smooth(method = "lm", se = FALSE,
              col = "orange") +
  labs(title = "Suicides per 100k of the population vs. GDP per capita",
       subtitle = "in 2015",
       x = "GDP per capita ($)",
       y = "Suicides per 100k of the population")
```

```{r linear-model-gdp-2015}
model_gdp_suicides_current <- lm(`suicides/100k pop.y` ~ `gdp_per_capita ($)`, data = suicide_economics_current)
tidy(model_gdp_suicides_current)
glance(model_gdp_suicides_current)$r.squared
```
Equation for the linear model is: (Suicides per 100k of the population-hat) = (1.274415e+02) + (2.168189e-04*GDP per capita($)) 
R-squared value is: 0.003774998

### Suicides and Generation

```{r vis-generation-suicides}
ggplot(data = suicides, mapping = aes(x = generation, y = `suicides/100k pop`)) +
  geom_boxplot() +
  coord_flip() +
  labs(title = "Suicides per 100k of the population vs. Generation",
       x = "Generation",
       y = "Suicides per 100k of the population")
```

### Suicides and Generation in 2015

```{r vis-generation-suicides-current}
suicides_current <- suicides %>%
  filter(year == "2015")
ggplot(data = suicides_current, mapping = aes(x = generation, y = `suicides/100k pop`)) +
  geom_boxplot() +
  labs(title = "Suicides per 100k of the population vs. Generation",
       subtitle = "in 2015",
       x = "Generation",
       y = "Suicides per 100k of the population")
```

### Suicides and Year

Group number of suicides together by year to find number of suicides for each year:

```{r year-suicides}
year_suicides<- suicides %>%
  group_by(year) %>% 
  summarize(n = sum(suicides_no))
```

Create visualization to represent the number of suicides for each year:

```{r year-suicides-visualization}
ggplot(data = year_suicides, mapping=aes(x = year, y =  n)) + 
  geom_col()  +  
  labs(title = "Number of Suicides for Each Year", 
       x = "Year", y = "Number of Suicides")
```

### Suicides and Sex

Group number of suicides together by sex to find number of suicides for each sex:

```{r sex-suicide}
suicides_sex <- suicides %>%
  group_by(sex) %>% 
  summarize(n = sum(`suicides/100k pop`))
```

Create visualization to represent the number of suicides for each year:

```{r sex-suicides-visualization}
ggplot(data = suicides_sex, mapping=aes(x = sex, y =  n, fill = sex)) + 
  geom_col() +
  labs(title = "Suicides by Gender from 1985-2016", 
       x = "Sex", y = "Number of Suicides per 100k Population")
```

Compare number of suicides for each sex per year:

```{r year-sex-suicides}
year_sex <- suicides %>%
  group_by(year, sex) %>% 
  summarize(n = sum(`suicides/100k pop`))
#year_sex <- spread(year_sex, sex, n)
year_sex
```

```{r year-sex-visualization}
ggplot(data = year_sex, mapping=aes(x = year, fill = sex)) + 
  geom_bar(position = "fill")  +  
  labs(title = "Proportions of Gender for Births in 2010-2017", 
       x = "Generation", y = "Number of Births")
```

### Suicides in the United States

```{r us-data}
suicides_us <- suicides %>%
  filter(country == "United States")
```

```{r us-suicides-over-time}

```


### Linear Modeling 

### Shiny App

```{r shinyapp}
ui <- fluidPage(
    
    # Sidebar layout with a input and output definitions
    sidebarLayout(
        
        # Inputs: Select variables to plot
        sidebarPanel(
            
           # Select country
            selectInput(inputId = "country_data",
                      label = "Country",
                      choices = suicides$country,
                      selected = "`Albania`"),
           
            # Select variable for x-axis
            selectInput(inputId = "x", 
                        label = "X-axis:",
                        choices = c("year", "sex", "age", "population", "`gdp_for_year ($)`",
                                    "`gdp_per_capita ($)`", "`HDI for year`"),
                        selected = "year"),
            
            # Select variable for y-axis
            selectInput(inputId = "y", 
                        label = "Y-axis:",
                        choices = c("suicides_no", "`suicides/100k pop`"), 
                        selected = "`suicides/100k pop`"),
            
            # Show data table
            checkboxInput(inputId = "show_data",
                          label = "Show Data: ",
                          value = FALSE)
            ),

        # Output
        mainPanel(
            
            # Show plot
            plotOutput(outputId = "plot"),
            
            # Show data table
            DT::dataTableOutput(outputId = "suicidetable")
        )
        
    )
)

# Define server function --------------------------------------------
server <- function(input, output) {
  
    # Create scatterplot object the plotOutput function is expecting
    output$plot <- renderPlot({
      
      if(input$x %in% c("age", "sex", "generation")){
         ggplot(data = subset(suicides, country %in% input$country_data), 
                aes_string(x = input$x, y = input$y)) +
            geom_boxplot()
      }
      
      else{
         ggplot(data = subset(suicides, country %in% input$country_data), 
                aes_string(x = input$x, y = input$y)) +
            geom_smooth()
      }
    })
    
    # Print data table if checked
    output$suicidetable <- DT::renderDataTable(
        if(input$show_data){
            DT::datatable(data = subset(suicides, country %in% input$country_data), 
                          options = list(pageLength = 15), 
                          rownames = FALSE)
        }
    )
}

# Create the Shiny app object ---------------------------------------
shinyApp(ui, server)
```



### Conclusion