---
title: "Suicide Data Analysis Project"
author: "Stats Stars"
date: "04/29/19"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
library(tidyverse)
library(broom)
library(ggplot2)
knitr::opts_chunk$set(echo = FALSE)
```

### Introduction

This dataset provides statistics for suicides worldwide between the years of 1985 and 2016. Each occurrence provided in the dataset represents the country, year, sex, age (in groups), number of suicides, population, suicide rate for 100 thousand people, country-year, hdi (human development), gdp for the year (in USD), the gdp per capita (in USD), and the generation of a single suicide.

The research question guiding this project is: 

Do location, year, sex, and economic situation contribute to suicide rates?

This research is important and relevant becuase understanding the relationship between location, year (time period), gender, and economic situation and mental health is important. Understand predictors of suicide can indicate where preventative measures can aid in mental health awareness and education as well as constructive prevention. 

### Load Data and Packages & Organize Data

To begin, we loaded the suicide data as well as the broom and tidyverse packages we will use throughout our analysis. We then renamed our variables so they would be easier to work with, such as removing the dollar sign from their name. In addition, we filtered out the 2016 data because it was not collected throughout the entire year, the collection was cut off and the volume of data does not match other years. Lastly, we releveled our generation and age variables so when we plot the categorical data they are in logical order.

```{r load-data, message=FALSE}
library(tidyverse)
library(broom)
suicides <- read_csv("/cloud/project/data/master.csv")
```

```{r suicides}
suicides <- suicides %>%
  mutate(Year = year,
         Age = age,
         Sex = sex,
         Country = country,
         Generation = generation,
         Population = population,
         suicides_per_100k_pop = `suicides/100k pop`, 
         gdp_for_year = `gdp_for_year ($)`, 
         gdp_per_capita = `gdp_per_capita ($)`,
         HDI_for_year = `HDI for year`,
         country_year = `country-year`) %>%
  filter(year != "2016")
```

```{r relevel-generation-age}
suicides <- suicides %>%
  mutate(Generation = fct_relevel(Generation, "G.I. Generation", "Silent", "Boomers", "Generation X", "Millenials", "Generation Z"))
suicides <- suicides %>%
  mutate(Age = fct_relevel(Age, "75+ years", "55-74 years", "35-54 years", "25-34 years", "15-24 years", "5-14 years"))
```

### Suicides and Location

To begin, we wanted to investigate which countries have the highest rate of suicide amongst their population in an average year (1985-2015). We created a bar graph that includes all of the countries in the data with their respective number of suicides per 100k population.

```{r country-plot, fig.height=12, fig.width=8}
topcountries <- suicides %>%
  group_by(country) %>%
  summarise(n = mean(suicides_per_100k_pop)) %>%
  arrange(desc(n))

ggplot(data = topcountries, mapping = aes(x = reorder(country,n), y = n)) +
  geom_bar(aes(y = n), stat = "Identity", fill="blue") +
  coord_flip() +
  labs(title = "Suicides per 100k people",
       subtitle = "by country",
       x = "Country",
       y = "Count")
```

Because looking at the bar graph is overwhelming with so much data, we printed the 10 countries with the highest suicide rates averaged over the years and their respective rates. The country with the highest suicide rates are as follows: Lithuania, Sri Lanka, Russian Federation, Hungary, Belarus, Kazakhstan, Latvia, Slovenia, Estonia, Ukraine. Their respective rates are 40.6, 35.3, 34.9, 33.0, 31.1, 30.4, 29.3, 27.8, 27.3 and lastly 26.6 suicides per 100k people. Because the United States is not within the top ten, we also printed its suicide rate, 13.819 suicides per 100k people. This was included because many viewers of this analysis have a particular interest in the United States as they are from this location.

```{r top10-and-US}
topcountries %>%
 slice(1:10)

topcountries %>%
  filter(country == "United States")
```

In addition to finding the 10 countries with the highest rates, we also looked at the summary statistics. On average, there are 11.969 suicides per 100k people in each country in a given year. There is a range of rates from 0 to 40.584 and a standard deviation of 9.373. This data is useful for comparing countries to the average. For example, the United States does not fall in countries with the highest 10 rates; however, the United States does have a suicide rate slightly above average.

```{r highest-rate-by-country}
topcountries %>%
  summarise(min = min(n), max = max(n),
            mean = mean(n), med = median(n),
            sd = sd(n), 
            q1 = quantile(n, probs = 0.25),
            q3 = quantile(n, probs = 0.75),
            iqr = (q3 - q1))
```

By sorting the data and differentiating the suicide rates of countries, we are able to look at and compare individual countries. For instance, lots of countries claim that they are the happiest nation. We can see if there is any comparison between happiness and rates of suicide in specific nations. For instance, we decided to compare The Netherlands and Ukraine. The Netherlands is ranked #5 in the World Happiness Report while Ukraine is ranked #133. 


```{r extreem}
extreem <- suicides %>%
  filter(country %in% c("Netherlands", "Ukraine"))
```


```{r suicide-happiness, message=FALSE}
ggplot(data = extreem, mapping=aes(x = year , y = suicides_per_100k_pop, color = country)) + 
  geom_smooth()  +  
  labs(title = "Netherlands & Ukraine Suicides by Year",
       x = "Year", y = "Number of Suicides/100K Population")
```

As demonstrated in the visualization, there is a significant difference in the suicide rates per 100k people between people in The Netherlands and Ukraine. Although correlation does not indicate causation, it is interesting to note that there does seem to be a relationship between happiness and suicide rates in a nation.

### Suicides and Economic Situation over all Time

We wanted to see if there was a correlation between proportion of suicides and the economic situation in each country. The measure of the economic situation in this data set is GDP per capita measured in US$. The dataset also includes a variable for GDP the whole year, but we thought GDP per capita would probably be a better measure of a country's economic affluence because it takes into account the relative size of the population and doesn't unfairly favor larger countries to smaller ones. We thus created a linear model that visualized the number of suicides per 100k of the population versus the GDP per capita. The graph used data from all countries in the dataset and from the years 1985-2015. There are a lot of data points on the graph and they are all quite scattered. When we fit a linear regression to the graph it gave the equation given below the graph and had an r-squared value also shown below the graph. The very low r-squared value and the very weak positive relationship the regression model gave, indicate that there is little, if any, relationship between GDP per capita and the number of suicides per 100k of the population.  

```{r create-dataframe-grouping-data-countryyear}
#aggregated all the suicides/100k pop data per country-year
suicides_grouped <- aggregate(suicides_per_100k_pop ~ country_year, data = suicides, FUN=sum)

#merged data set created with old one to have access to gdp data
suicide_economics <- merge(suicides, suicides_grouped, by.x = "country_year", by.y = "country_year") %>%
  select(country_year, suicides_per_100k_pop.y, gdp_per_capita)
```

```{r vis-suicide-gdp-per-capita}
ggplot(data = suicide_economics, mapping = aes(x = gdp_per_capita, y = suicides_per_100k_pop.y)) + 
  geom_point(size = 0.1, color = "blue") +
  geom_smooth(method = "lm", se = FALSE,
              col = "orange") +
  labs(title = "Suicides per 100k of the population vs. GDP per capita",
       x = "GDP per capita ($)",
       y = "Suicides per 100k of the population")
```

```{r linear-model-suicide-economics}
model_gdp_suicides <- lm(suicides_per_100k_pop.y ~ gdp_per_capita, data = suicide_economics)
tidy(model_gdp_suicides)
glance(model_gdp_suicides)$r.squared
```

Equation for the linear model is: (Suicides per 100k of the population-hat) = (153) + (0.0000243*GDP per capita($)) 

R-squared value is: 1.534907e-05

The intercept of this model is 153. This means that for a country with a $0 GDP per capita the number of suicides per 100k of the population would be expected to be, on average, 153.

The slope of this model is 0.0000243. This means that for every $1 increase in GDP per capita, the number of suicides per 100k of the population is expected to increase, on average, by 0.0000243.

The r-squared value is 1.534907e-05. This means that the GDP per capita in US$ explains 0.00153% of variability in the number of suicides per 100k of the population.

### Suicides and Economic Situation in 2015

Because the previous graph showed so much variability in how GDP per capita affected the proportion of suicides, we were curious to see if the relationship would prove to be clearer by focusing on a single time period. We also thought that GDP per capita might be an imperfect statistic in tracking relative economic affluence over a large period of time. For this reason we made the same visualization and linear regression model, but this time only using data from 2015. This model showed a slightly larger positive correlation between increasing GDP per capita ($) and number of suicides per 100k of the population, but the r-squared value was still not high enough to show any significant correlation. 
```{r create-dataframe-grouping-data-countryyear-2015}
suicides_current <- suicides %>%
  filter(Year == "2015")

#aggregated all the suicides/100k pop data per country-year
suicides_grouped_current <- aggregate(suicides_per_100k_pop ~ country_year, data = suicides_current, FUN=sum)

#merged data set created with old one to have access to gdp data
suicide_economics_current <- merge(suicides, suicides_grouped_current, by.x = "country_year", by.y = "country_year") %>%
  select(country_year, suicides_per_100k_pop.y, gdp_per_capita)
```

```{r vis-suicide-gdp-per-capita-2015}
ggplot(data = suicide_economics_current, mapping = aes(x = gdp_per_capita, y = suicides_per_100k_pop.y)) + 
  geom_point(size = 0.5, color = "blue") +
  geom_smooth(method = "lm", se = FALSE,
              col = "orange") +
  labs(title = "Suicides per 100k of the population vs. GDP per capita",
       subtitle = "in 2015",
       x = "GDP per capita ($)",
       y = "Suicides per 100k of the population")
```

```{r linear-model-gdp-2015}
model_gdp_suicides_current <- lm(suicides_per_100k_pop.y ~ gdp_per_capita, data = suicide_economics_current)
tidy(model_gdp_suicides_current)
glance(model_gdp_suicides_current)$r.squared
```
Equation for the linear model is: (Suicides per 100k of the population-hat) = (127) + (2.168189e-04*GDP per capita($)) 

The R-squared value is: 0.003774998

The intercept of this model is 127. This means that for a country in 2015 with a $0 GDP per capita the number of suicides per 100k of the population would be expected to be, on average, 127.

The slope of this model is 2.168189e-04. This means that for every $1 increase in a country's GDP per capita in 2015, the number of suicides per 100k of the population is expected to increase, on average, by 2.168189e-04.

The r-squared value is 0.003774998. This means that the GDP per capita ($) explains 0.377% of variability in the number of suicides per 100k of the population in 2015.

### Suicides and Generation

We wanted to also explore the link between generation and suicide rates. The boxplot shown below clearly shows that each older generation has higher suicide rates than the one after it, meaning that suicide rates are largely decreasing over time. This trend is mirrored in the trends of suicide rate over the years. However, the conclusions drawn from this graph are still not completely certain because all the generations included in the graph, other than the G.I. Generation and the Silent Generation, are still alive and will continue to show different suicide rates as time progresses. This is even more important when considering that older people show consistently higher suicide rates than younger people, so each generation that is still alive is expected to show higher suicide rates as they grow older.
There does seem to be a cluster of outliers in the Silent generation that is even higher than most of the outliers in G.I. Generation. When we did some further digging into the possible causes of this, we found that those abnormally high suicide rates among the Silent generation were almost all due to Korea's high suicide rates in 75+ year old men between the years of 2003 and 2015. When we did further research we found that the cause of those abnormally high suicide rates is because the elderly have no source of income because the country's pension system only began in 1988. As the country advances many young people leave their parents behind. And even if the young continue to financially support their parents, the older generation does not want to be a financial burden. This is causing their abnormally high suicide rates.

```{r vis-generation-suicides}
ggplot(data = suicides, mapping = aes(x = Generation, y = suicides_per_100k_pop)) +
  geom_boxplot() +
  coord_flip() +
  labs(title = "Suicides per 100k of the population vs. Generation",
       x = "Generation",
       y = "Suicides per 100k of the population")
```

### Suicides and Age Group

Next, we decided to look at what age people are most likely to commit suicide. The boxplot below shows a clear positive trend in increasing age and proportion of suicides. From the summary statistics shown below the graph, we can infer that a person 75+ years of age is almost two times more likely to commit suicide than someone between 25 and 34 years old. 
```{r vis-age-suicides}
ggplot(data = suicides, mapping = aes(x = Age, y = suicides_per_100k_pop)) +
  coord_flip() +
  geom_boxplot() +
  labs(title = "Suicides per 100k of the population vs. Age",
       x = "Age",
       y = "Suicides per 100k of the population")
```

```{r age-suicides-summarystats}
suicides %>%
  group_by(Age) %>%
  summarise(mean = mean(suicides_per_100k_pop),
            median = median(suicides_per_100k_pop),
            min = min(suicides_per_100k_pop),
            max = max(suicides_per_100k_pop),
            sd = sd(suicides_per_100k_pop),
            q1 = quantile(suicides_per_100k_pop, probs = 0.25),
            q3 = quantile(suicides_per_100k_pop, probs = 0.75),
            iqr = (q3-q1))
```


### Suicides Rates Among Young People in the US over Time

Though 5-14 year olds clearly have the lowest suicide rates of any age group, we were curious to see if their suicide rates had increased in the US over time. The reason we were curious about this is because we have seen a lot of things in the news recently about increased mental health issues in the US among school-aged children. We therefore wanted to see if that trend was reflected in increased suicide rates among very young people. The graph below shows that unfortunately, suicide do seem to have spiked recently among 5-14 year olds in the US. They reached a peak in 2014 when there were 2.04 suicides per 100k people in the population. Suicide rates climbed to that peak from a low of 0.9 per 100k people in 2007. In 2015 suicide rates dropped slightly from 2014, and we are hopeful that that downward trend will continue.
```{r young-data-us}
suicides_us <- suicides %>%
  filter(Country == "United States")
suicides_us_veryyoung <- suicides_us %>%
  filter(Age == "5-14 years")
suicides_grouped_sex <- aggregate(suicides_per_100k_pop ~ Year, data = suicides_us_veryyoung, FUN=sum)
```

```{r vis-young-us-overtime}
ggplot(data = suicides_grouped_sex, mapping = aes(x = Year, y = suicides_per_100k_pop)) + 
  geom_line(color = "red") + 
  geom_point(color = "red") +
  labs(title = "Suicide rates over time among 5-14 year olds in the US",
       x = "Year",
       y = "Suicides per 100k of the population")
```


### Suicides and Year

```{r year-suicides}
year_suicides<- suicides %>%
  group_by(Year) %>% 
  summarize(n = mean(suicides_per_100k_pop))
```

Create visualization to represent the mean number of suicides/100k population for each year:

```{r year-suicides-visualization}
ggplot(data = year_suicides, mapping=aes(x = Year, y =  n)) + 
  geom_line(color = "blue")  +  
  labs(title = "Mean Number of Suicides/100K Population for Each Year", 
       x = "Year", y = "Mean Number of Suicides/100K Population")
```

Calculate summary statistics for mean number of suicides/100k population over the years:

```{r summary-year-suicides}
year_suicides %>%
  summarise(min = min(n), max = max(n),
            mean = mean(n), med = median(n),
            sd = sd(n), 
            q1 = quantile(n, probs = 0.25),
            q3 = quantile(n, probs = 0.75),
            iqr = (q3 - q1))
```

The highest average number of suicides was 15.7 suicides/100k population in 1995. Suicides have been declining since then. On average, there was an average of 12.7 suicides/100k population across all the years. 


```{r us-suicides}
us_suicides <- suicides %>%
  filter(Country == "United States") %>%
  group_by(Year) %>% 
  summarize(n = mean(suicides_per_100k_pop))
```

Create visualization to represent the mean number of suicides/100k population for each year in the US:

```{r us-suicides-visualization}
ggplot(data = us_suicides, mapping=aes(x = Year, y =  n)) + 
  geom_line(color = "red")  +  
  labs(title = "Mean Number of Suicides/100K Population for Each Year in the United States", 
       x = "Year", y = "Mean Number of Suicides/100K Population")
```

Calculate summary statistics for mean number of suicides/100k population over the years in the US:

```{r summary-us-suicides}
us_suicides %>%
  summarise(min = min(n), max = max(n),
            mean = mean(n), med = median(n),
            sd = sd(n), 
            q1 = quantile(n, probs = 0.25),
            q3 = quantile(n, probs = 0.75),
            iqr = (q3 - q1))
```

Across all the years, the US has an average number of suicides/100k population of 13.8. The highest average number of suicides/100K population occuring in the United States was 16 suicides in 1986 and 1987. Since 2006, the graph shows that suicides have been increasing. This increase in suicides can be linked to the financial crisis in 2007. Increased suicides were caused by job loss, home foreclosures, and debt from the unanticipated national housing downturn. Unemployment also caused higher divorce rates and abuse rates in homes in the US.

### Suicides and Sex

```{r sex-suicide}
suicides_sex <- suicides %>%
  group_by(Sex) %>%
  summarize(n = mean(suicides_per_100k_pop))
```

Create visualization to represent the mean number of suicides/100k population for each year:

```{r sex-suicides-visualization}
ggplot(data = suicides_sex, mapping=aes(x = Sex, y =  n, fill = Sex)) + 
  geom_col() +
  labs(title = "Mean Number of Suicides/100K Population by Sex", 
       x = "Sex", y = "Mean Number of Suicides per 100k Population")
```

In the visualization and data collected from the dataset, the mean number of suicides/100k population for females was 5.4 suicides while for males, was 20.2 suicides. Males had 3.7 times the number of suicides as females. This was contributed to the fact that men were more likely to die from suicides, even though women were found to attempt suicides 3-4 times more often than men. Men used more lethal means for suicide because men were more comfortable with guns, while women took pills and were less likely to die from their suicide attempts. There is also evidence that shows that men are not as inclined to seek help for mental disorders because of their masculine ideals, and their mental health declines and feelings build up with no escape, unlike women who are more likely to seek help before escalating to suicide.  

```{r year-sex-suicides}
year_sex <- suicides %>%
  group_by(Year, Sex) %>% 
  summarize( n = mean(suicides_per_100k_pop))
```

Create visualization to represent proportions of gender for number of suicides/100K population by year:

```{r line}
ggplot(year_sex, aes(x = Year, y = n, color = Sex)) +
    geom_line() +
    labs(title = "Changes in Male and Female Suicide Rates Over Time",
         x = "Year", y = "Mean Number of Suicides per 100k People")
```


### Linear Modeling 

To figure out which variables influence suicides the most, we will be doing a linear regression. 

```{r full-model}
nrow(suicides)
#full_model <- lm(suicides_per_100k_pop ~ Age + Year + Country + Sex +
                  # Generation + Population + gdp_for_year +
                  # gdp_per_capita + HDI_for_year + country_year, data = suicides)

full_model <- lm(suicides_per_100k_pop ~ Age + Year + Country + Sex +
                   Generation + Population + gdp_for_year +
                   gdp_per_capita, data = suicides)
```

When we ran the full model selection, RStudio was becomming overloaded and crashing, so we decided to pair down the number of variables in the model. We chose to keep the variables that we were investigating in the research question. Although this is not true to the entire dataset, it allows us to answer our research question given the circumstances. 
 
```{r select-model}
selected_model <- step(full_model, direction = "backward")
```


### Shiny App

An added feature to our project is a Shiny App. This feature allows a user to choose a country, and look at data specific to their country of choice. The Shiny App has all the variables as options on the x-axis, both categorical and numerical, and allows for the user to choose between the number of suicides, or suicides per 100k population. In order to account for both numerical and categorical variables on the x axis, there are two types of plots: a boxplot, and a scatterplot only showing the geom_smooth. One last feature is that the user can choose (by checking a box) whether or not to display the data in a table form beneath the plot.

```{r shinyapp}
ui <- fluidPage(
    
    # Sidebar layout with a input and output definitions
    sidebarLayout(
        
        # Inputs: Select variables to plot
        sidebarPanel(
            
           # Select country
            selectInput(inputId = "country_data",
                      label = "Country",
                      choices = suicides$country,
                      selected = "`Albania`"),
           
            # Select variable for x-axis
            selectInput(inputId = "x", 
                        label = "X-axis:",
                        choices = c("Year", "Sex", "Age", "Generation", "Population", "gdp_for_year",
                                    "gdp_per_capita", "HDI_for_year"),
                        selected = "Year"),
            
            # Select variable for y-axis
            selectInput(inputId = "y", 
                        label = "Y-axis:",
                        choices = c("suicides_no", "suicides_per_100k_pop"), 
                        selected = "suicides_per_100k_pop"),
            
            # Show data table
            checkboxInput(inputId = "show_data",
                          label = "Show Data: ",
                          value = FALSE)
            ),

        # Output
        mainPanel(
            
            # Show plot
            plotOutput(outputId = "plot"),
            
            # Show data table
            DT::dataTableOutput(outputId = "suicidetable")
        )
        
    )
)

# Define server function --------------------------------------------
server <- function(input, output) {
  
    # Create scatterplot object the plotOutput function is expecting
    output$plot <- renderPlot({
      
      if(input$x %in% c("Age", "Sex", "Generation")){
         ggplot(data = subset(suicides, country %in% input$country_data), 
                aes_string(x = input$x, y = input$y)) +
            geom_boxplot()
      }
      
      else{
         ggplot(data = subset(suicides, country %in% input$country_data), 
                aes_string(x = input$x, y = input$y)) +
            geom_smooth()
      }
    })
    
    # Print data table if checked
    output$suicidetable <- DT::renderDataTable(
        if(input$show_data){
            DT::datatable(data = subset(suicides, country %in% input$country_data), 
                          options = list(pageLength = 15), 
                          rownames = FALSE)
        }
    )
}

# Create the Shiny app object ---------------------------------------
shinyApp(ui, server)
```

### Conclusion

Analyzing this dataset has shown a many new links between different variables and suicide rates. 
Our anaylsis of the correlation between suicide rate and GDP per capita ($) showed that there was little to no correlation between the two variables. Even after filtering the data for just 2015, the linear regression fitted to the model showed that there was still no good correlation between the two variables. This indicates that a countries GDP per capita is not indicative of whether or not they have a high or low suicide rate.

We also preformed an analysis on the link between different generations and suicide rates. To do this analysis we made a boxplot graph. The boxplot showed a clear trend: that older generation have had larger suicide rates than later generations. However, there is a caveat to this conclusion since many of the generations included in the boxplots are still alive, and thus their aggregate suicide rate over their whole lifetime is not complete yet.
In the analysis of generations we also found an interesting outlier in the Silent Generation. This cluster of outliers was found to all be data points from Korean men in 2003 to 2015. Upon further exploration we found that the cause was financial stresses placed upon older populations in South Korea. 

We then performed an analysis on the link between age and suicide rate. We found, through boxplots, that the older someone is, the more likely they are to commit suicide. 

We were then curious whether the US would show increased rates of suicide among the youngest age group in recent years due to an increase in mental health issues we had heard a lot about. Though our data certainly does not prove any causation between increased mental health issues in school age children and an increase in the proportion of suicides, our data did find a peak in suicide rates among 5-14 year olds in the US in 2014. 

When coming to these conclusions and interpreting these data, one must keep in 

### Citations
https://bpr.berkeley.edu/2017/10/31/the-scourge-of-south-korea-stress-and-suicide-in-korean-society/  

https://www.forbes.com/sites/melaniehaiken/2014/06/12/more-than-10000-suicides-tied-to-economic-crisis-study-says/#41e912947ae2

https://healthydebate.ca/2017/08/topic/male-suicide

https://s3.amazonaws.com/happiness-report/2019/WHR19.pdf

